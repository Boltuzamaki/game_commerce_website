{% extends "base.html" %}

{% block title %}Checkout Page - GAMERCE{% endblock %}

{% block content %}
<main class="max-w-6xl mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6">
    Your Shopping Cart
  </h1>
  <div class="flex flex-col lg:flex-row lg:space-x-6">
    <div class="flex-1 space-y-6">
      {% for game in cart_games %}
      <div class="flex space-x-4">
        <img alt="{{ game.name }} game cover" class="w-24 h-36 object-cover" height="150" src="{{ game.headerImage }}" width="100"/>
        <div class="flex-1">
          <div class="flex justify-between">
            <h2 class="text-xl font-bold">
              {{ game.name }}
            </h2>
            <span class="text-xl font-bold">
              ${{ game.price }}
            </span>
          </div>
          <p class="text-gray-400 mt-2">
            {{ game.shortDesc[:150] }}....
          </p>
          <button class="mt-4 bg-gray-700 text-white py-2 px-4 rounded" onclick="removeGame('{{ game.name }}')">
            Remove
          </button>
        </div>
      </div>
      {% endfor %}
      <div class="flex space-x-4">
        <button class="bg-gray-700 text-white py-2 px-4 rounded">
          Continue shopping
        </button>
        <button class="bg-gray-700 text-white py-2 px-4 rounded" onclick="removeAllGames()">
          Remove all
        </button>
      </div>
    </div>
    <div class="mt-6 lg:mt-0 lg:w-1/3">
      <div class="bg-gray-800 p-6 rounded">
        <div class="flex justify-between mb-4">
          <span class="text-lg font-bold">
            Estimated total
          </span>
          <span class="text-lg font-bold">
            ${{ cart_games | sum(attribute='price') }}
          </span>
        </div>
        <p class="text-gray-400 mb-4">
          Sales tax will be calculated during checkout where applicable
        </p>
        <button class="w-full bg-purple-600 text-white py-2 px-4 rounded">
          Continue to payment
        </button>
      </div>
    </div>
  </div>
</main>

<script>
  function removeGame(gameName) {
    fetch('/cart', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ game_name: gameName, action: 'remove' }),
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      }
    });
  }

  function removeAllGames() {
    fetch('/cart', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ action: 'remove_all' }),
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      }
    });
  }
</script>
{% endblock %}
